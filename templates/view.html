
<html lang="fr">
<head>
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/solid.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/thinline.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/radio_card2.css')}}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{{url_for('static', filename='ressources/bm_gradignan_geii_rvb.png')}}">
    <title>List Mission</title>
</head>
<body class="view">
    <input class="checkbox" type="checkbox" name="general" id="general">
                <label class="for-checkbox" for="general"></label>
                <div class="FABMenu">
                    <input type="checkbox" autocomplete="off"/>
                    <div class="hamburger">
                      <div class="dots">
                        <span class="first"></span>
                        <span class="second"></span>
                        <span class="third"></span>
                      </div>
                    </div>
                    <div class="action_items_bar">
                      <div class="action_items">
                        <a class="first_item" href="http://geii.iut.u-bordeaux.fr/mission">
                          <i class="material-icons">
                          home
                          </i>
                        </a>
                        <a class="second_item" id="go-back">
                            <script>
                                document.getElementById("go-back").addEventListener("click", () => {
                                    history.back();
                                  });
                            </script>
                          <i class="material-icons">
                            keyboard_double_arrow_left
                          </i>
                        </a>
                        <a class="third_item">
                            <i class="material-icons">
                                admin_panel_settings
                            </i>
                        </a>
                        <a class="fourth_item" id="go-reload">
                            <script>
                                document.getElementById("go-reload").addEventListener("click", () => {
                                    window.location.reload()
                                  });
                            </script>
                            <i class="material-icons">
                                refresh
                            </i>
                        </a>
                      </div>
                    </div>
                  </div>
    <div class="background-color"></div>
    <ul class="view" id="list_view">
        {% if ADMIN %}
            <li class="view" id="title"><div style="width: 99%; background: none;display: flex;align-items: center;margin: 7.5px;">
                <div class="view" id="id_mission">ID Mission</div>
                <div class="view" id="nom_mission">NOM Mission</div> 
                <div class="view" id="id_user">Demandeur
                    <div class="listsearch">
                        <input class="chosen-value" id="selected_user" type="text" value="" placeholder="Choisir un Pays" autocomplete="off">
                        <ul class="value-list">
                            {% for user in All_User %}
                                <li michel="NAME" value="{{user}}">{{user}}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <script>
                        const inputField = document.querySelector('.chosen-value');
                        const dropdown = document.querySelector('.value-list');
                        const dropdownArray = [... document.querySelectorAll('[michel*="NAME"]')];
                        console.log(typeof dropdownArray)
                        dropdown.classList.add('open');
                        inputField.focus(); // Demo purposes only
                        let valueArray = [];
                        dropdownArray.forEach(item => {
                          valueArray.push(item.textContent);
                        });
                        
                        const closeDropdown = () => {
                          dropdown.classList.remove('open');
                        }
                        
                        inputField.addEventListener('input', () => {
                          dropdown.classList.add('open');
                          let inputValue = inputField.value.toLowerCase();
                          let valueSubstring;
                          if (inputValue.length > 0) {
                            for (let j = 0; j < valueArray.length; j++) {
                                console.log(valueArray[j].toLowerCase().includes(inputValue.toLowerCase()))
                              if (!(valueArray[j].substring(0).toLowerCase().include(inputValue.toLowerCase()))) {
                                dropdownArray[j].classList.add('closed');
                              } else {
                                dropdownArray[j].classList.remove('closed');
                              }
                            }
                          } else {
                            for (let i = 0; i < dropdownArray.length; i++) {
                              dropdownArray[i].classList.remove('closed');
                            }
                          }
                        });
                        
                        dropdownArray.forEach(item => {
                          item.addEventListener('click', (evt) => {
                            inputField.value = item.textContent;
                            dropdownArray.forEach(dropdown => {
                              dropdown.classList.add('closed');
                            });
                          });
                        })
                        
                        inputField.addEventListener('focus', () => {
                           inputField.placeholder = 'Recherche';
                           dropdown.classList.add('open');
                           dropdownArray.forEach(dropdown => {
                             dropdown.classList.remove('closed');
                           });
                        });
                        
                        inputField.addEventListener('blur', () => {
                           inputField.placeholder = 'Choisir un Pays';
                          dropdown.classList.remove('open');
                        });
                        
                        document.addEventListener('click', (evt) => {
                          const isDropdown = dropdown.contains(evt.target);
                          const isInput = inputField.contains(evt.target);
                          if (!isDropdown && !isInput) {
                            dropdown.classList.remove('open');
                          }
                        });
                    </script> 
                </div>
                <div class="view" id="date">Date</div> 
                <div class="view" id="status">Status</div>
                </div>
            </li>
        {% else %}
            <li class="view" id="title"><div style="width: 99%; background: none;display: flex;align-items: center;margin: 7.5px;"><div class="view" id="id_mission">ID Mission</div> <div class="view" id="id_user">Demandeur</div> <div class="view" id="date">Date</div> <div class="view" id="status">Status</div></div></li>
        {% endif %}
        {% set list = ["Ouvert","En cours de traitement","Validé","Cloturé"] %}.
        {% set color = ["#008000","#caac00","#ca0000","#2c2c2c"] %}. 
        {% for mission in Missions %}
            <a href="http://geii.iut.u-bordeaux.fr/mission/view_mission/{{mission[0]}}" style="text-decoration:none;">
            <li class="view" id="view_mission" user="{{mission[2]}}" >
                <div class="view" id="background" >
                    <div class="view" id="id_mission">{{mission[0]}}</div> 
                    <div class="view" id="nom_mission">NOM Mission</div> 
                    <div class="view" id="id_user">{{mission[2]}}</div> 
                    <div class="view" id="date" date="{{mission[3]}}"></div>
                    <div class="view" id="status">{{list[mission[4]]}}</div>
                </div>
                <style>
                    div.view#background{
                        background-color: {{color[mission[4]]}};
                    }
                </style>
            </li>
            </a>
        {% endfor %}
    </ul>
</body>
<script>
    const selector = document.getElementById("selected_user")
    selector.addEventListener("change",select_user)
    function select_user(){
        Nodelist = document.querySelectorAll('[id*="view_mission"]')
        for (i in Nodelist){
            let node = Nodelist[i]
            //console.log(node)
            if (selector.value == ""){
                /*console.log("SET ALL")*/
                node.style.display = "flex";
            }else{
                if (node.getAttribute('user') == selector.value){
                    /*console.log("SET ",node.getAttribute('user')," to flex")*/
                    node.style.display = "flex";
                }else{
                    /*console.log("SET ",node.getAttribute('user')," to none")*/
                    //console.log(selector.value)
                    node.style.display = "none";
                    
                }
                
            }
            
        }
    }
    function Dated(){
        Nodelist = document.querySelectorAll('[id*="view_mission"]')
        let mois = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
        for (i in Nodelist){
            let node = Nodelist[i];
            //console.log(node);
            let nodedate = node.querySelectorAll('[id*="date"]');
            //console.log(nodedate[0].getAttribute("date"));
            let date = new Date(parseInt(nodedate[0].getAttribute("date")));
            nodedate[0].innerHTML = date.getDate()+" "+ mois[date.getMonth()]+" "+(1900+date.getYear());
        }
    }
    Dated()
</script>
</html>