
<html lang="fr">
<head>
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{{url_for('static', filename='ressources/bm_gradignan_geii_rvb.png')}}">
    <title>List Mission</title>
</head>
<body class="view">
    <ul class="view" id="list_view">
        {% if ADMIN %}
            <li class="view" id="title"><div style="width: 99%; background: none;display: flex;align-items: center;margin: 7.5px;">
                <div class="view" id="id_mission">ID Mission</div> 
                <div class="view" id="id_user">Demandeur
                    <select name="selected_user" id="selected_user">
                        <option value="ALL">ALL</option>
                        {% for user in All_User %}
                            <option value="{{user}}">{{user}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="view" id="date">Date</div> 
                <div class="view" id="status">Status</div>
                </div>
            </li>
        {% else %}
            <li class="view" id="title"><div style="width: 99%; background: none;display: flex;align-items: center;margin: 7.5px;"><div class="view" id="id_mission">ID Mission</div> <div class="view" id="id_user">Demandeur</div> <div class="view" id="date">Date</div> <div class="view" id="status">Status</div></div></li>
        {% endif %}
        {% set list = ["Ouvert","En cours de traitement","Validé","Cloturé"] %}.
        {% set color = ["#008000","#caac00","#ca0000","#2c2c2c"] %}. 
        {% for mission in Missions %}        
            <li class="view" id="view_mission" user="{{mission[2]}}" href="http://geii.iut.u-bordeaux.fr/mission/view_mission/{{mission[0]}}">
                <div class="view" id="background" >
                    <div class="view" id="id_mission">{{mission[0]}}</div> 
                    <div class="view" id="id_user">{{mission[2]}}</div> 
                    <div class="view" id="date">{{mission[3]}}</div>
                    <div class="view" id="status">{{list[mission[4]]}}</div>
                </div>
                <style>
                    div.view#background{
                        background-color: {{color[mission[4]]}};
                    }
                </style>
            </li>
        {% endfor %}
    </ul>
</body>
<script>
    const selector = document.getElementById("selected_user")
    selector.addEventListener("change",select_user)
    function select_user(){
        Nodelist = document.querySelectorAll('[id*="view_mission"]')
        for (i in Nodelist){
            let node = Nodelist[i]
            //console.log(node)
            if (selector.value == "ALL"){
                /*console.log("SET ALL")*/
                node.style.display = "flex";
            }else{
                if (node.getAttribute('user') == selector.value){
                    /*console.log("SET ",node.getAttribute('user')," to flex")*/
                    node.style.display = "flex";
                }else{
                    /*console.log("SET ",node.getAttribute('user')," to none")*/
                    //console.log(selector.value)
                    node.style.display = "none";
                    
                }
                
            }
            
        }
    }
    function Dated(){
        Nodelist = document.querySelectorAll('[id*="view_mission"]')
        let mois = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
        for (i in Nodelist){
            let node = Nodelist[i];
            console.log(node);
            let nodedate = node.querySelectorAll('[id*="date"]');
            console.log(nodedate[0].innerHTML);
            let date = new Date(parseInt(nodedate[0].innerHTML));
            nodedate[0].innerHTML = date.getDate()+" "+ mois[date.getMonth()]+" "+(1900+date.getYear());
        }
    }
    Dated()
</script>
</html>